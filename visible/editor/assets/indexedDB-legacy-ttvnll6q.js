System.register(["./index-legacy-VYyxLGrq.js"],(function(e,n){"use strict";var t,r,s,o,a,c,i;return{setters:[e=>{t=e.f,r=e.h,s=e.F,o=e.N,a=e.d,c=e.m,i=e.u}],execute:function(){const n=function(){const e=["indexedDB","webkitIndexedDB","mozIndexedDB","OIndexedDB","msIndexedDB"];for(let n=0,t=e.length;n<t;n++){const t=e[n];if(window[t])return window[t]}}();function u(e,n){if(typeof e!=typeof n)return!1;if("object"!=typeof e)return e===n;const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(let s of t)if(!u(e[s],n[s]))return!1;return!0}const d="ocstore";function l(e){const t=e.dbName,r=e.keypath,s=e.version,o=e.type||(r?"getItem":"clear"),a=!!e.isFile;return new Promise(((c,i)=>{if(n||i({result:"error",msg:"indexedDB在该设备不兼容"}),"clear"===o||r||i({result:"error",msg:"keypath不能为空"}),"clear"===o){const e=n.deleteDatabase(t);return e.onsuccess=function(){c({result:"success",msg:"成功删除数据库"})},void(e.onerror=function(){i({result:"error",msg:"删除数据库失败"})})}const l=n.open(t,"number"!=typeof s?1:s);let m;const p=(e="readwrite")=>m.transaction([d],e).objectStore(d),f=e=>new Promise(((n,t)=>{try{const r=p().get(e);r.onerror=function(){t("onerror")},r.onsuccess=function(){const e=r.result;n(e)}}catch(r){t(r)}}));l.onupgradeneeded=()=>{m=l.result,m.objectStoreNames.contains(d)||m.createObjectStore(d)},l.onsuccess=()=>{if(m=l.result,m.onerror=function(){i({result:"error",msg:"Error creating/accessing IndexedDB database"})},"getItem"===o)return void f(r).then((e=>{c({result:"success",data:e,msg:"success"})}),(e=>{i({result:"error",msg:e})}));if("removeItem"===o)return void(n=r,new Promise(((e,t)=>{try{const r=p().delete(n);r.onerror=function(){t()},r.onsuccess=function(){e(n)}}catch(r){t(r)}}))).then((()=>{c({result:"success",data:null,msg:"success"})}),(e=>{i({result:"error",msg:e})}));var n;const t=e=>{(function(e,n){return new Promise(((t,r)=>{try{const s=p().put(n,e);s.onerror=function(){r()},s.onsuccess=function(){t(e)}}catch(s){r(s)}}))})(r,e).then((()=>{c({result:"success",msg:"success"})}),(e=>{i({result:"error",msg:e})}))};f(r).then((n=>{if(a){if(!n||"string"==typeof n&&/^https?:\/\//.test(n))return void(r=e.data,new Promise((e=>{const n=new XMLHttpRequest;n.open("GET",r,!0),n.responseType="blob",n.send(),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?e(n.response):e(r))}}))).then((e=>{t(e)}),(()=>{i({result:"error",msg:"error"})}))}else if(!u(n,e.data))return void t(e.data);var r;c({result:"success",msg:"success"})}))},l.onerror=function(){i({result:"error",msg:"数据库打开报错"})},l.onblocked=function(){i({result:"error",msg:"Your database version can't be upgraded because the app is open somewhere else."})}}))}const m=o("h1",null,"@reaf-toolkit/indexedDB",-1),p=o("blockquote",null,[o("p",null,"indexedDB 封装")],-1),f=o("h1",null,"Installation",-1),g=o("h2",null,"Using npm:",-1),y=o("pre",null,[o("code",{class:"language-zsh","v-pre":"true"},"$ npm i -g npm\n$ npm i --save @reaf-toolkit/indexedDB\n")],-1),h=o("h2",null,"Using yarn:",-1),b=o("pre",null,[o("code",{class:"language-zsh","v-pre":"true"},"$ yarn add @reaf-toolkit/indexedDB\n")],-1),D=o("h2",null,"Usage",-1),x=o("pre",null,[o("code",{class:"language-ts","v-pre":"true"},'import indexedDB from "@reaf-toolkit/indexedDB";\n\nconst dbName = "imgFile";\nconst fileKey = "favicon.png";\n\nindexedDB({\n  dbName,\n  keypath: fileKey,\n  type: "setItem",\n  isFile: true,\n  data: fileKey,\n});\n\nindexedDB({\n  dbName,\n  keypath: fileKey,\n  type: "getItem",\n});\n\nindexedDB({\n  dbName,\n  keypath: fileKey,\n  type: "removeItem",\n});\n\nindexedDB({\n  dbName,\n  type: "clear",\n});\n\nindexedDB({\n  dbName: "jsondata",\n  keypath: "testname",\n  type: "setItem",\n  data: {\n    name: "sunshine",\n  },\n});\n')],-1),k={render:function(e,n){return t(),r(s,null,[m,p,f,g,y,h,b,D,x],64)},__hmrId:"/Users/sunshine/gitStore/visible/packages/indexedDB/README.md"},v={class:"markdown-body"},B="imgFile",I="favicon.png";e("default",a({__name:"indexedDB",setup:e=>(l({dbName:B,keypath:I,type:"setItem",isFile:!0,data:I}),l({dbName:B,keypath:I,type:"getItem"}),l({dbName:B,keypath:I,type:"removeItem"}),l({dbName:B,type:"clear"}),l({dbName:"jsondata",keypath:"testname",type:"setItem",data:{name:"sunshine"}}),(e,n)=>(t(),r("div",v,[c(i(k))])))}))}}}));
